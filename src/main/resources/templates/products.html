<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title th:text="#{title}">Listado de productos</title> <!-- Usando i18n para el título -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <style>
        /* Estilo para la tabla y filtros */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px; /* Espacio entre el encabezado y la tabla */
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .filter-container {
            display: flex;
            justify-content: space-between; /* Espacio entre los filtros */
            margin-bottom: 10px; /* Margen inferior para separar de la tabla */
        }

        .filter-container input {
            width: 30%; /* Ancho de los filtros */
            padding: 8px; /* Espaciado interno */
            box-sizing: border-box; /* Para incluir padding en el ancho total */
        }
    </style>
</head>
<body>
<h1 th:text="#{title}">Listado de productos</h1> <!-- Usando i18n para el encabezado -->

<!-- Contenedor de Filtros -->
<div class="filter-container">
    <input type="text" id="idFilter" placeholder="Filtrar por ID">
    <select id="categoryFilter">
        <option value="" th:text="#{filter_category}">Filtrar por categoría</option>
        <option th:each="category : ${categories}" th:value="${category}" th:text="${category}"></option>
    </select>
    <button id="resetFilter" type="button">Reestablecer Filtros</button>
    <input type="number" id="priceFilter" th:placeholder="#{filter_price}" placeholder="Filtrar por precio (Min)">
    <input type="number" id="stockFilter" th:placeholder="#{filter_stock}" placeholder="Filtrar por stock (Min)">
</div>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th th:text="#{code}">Código</th>
        <th th:text="#{category}">Categoría</th>
        <th th:text="#{price}">Precio</th>
        <th th:text="#{name}">Nombre</th>
        <th th:text="#{description}">Descripción</th>
    </tr>
    </thead>
    <tbody id="productTable">
    <tr th:each="product : ${products}">
        <td><a th:href="@{'/products/' + ${product.id}}" th:text="${product.id}"></a></td>
        <td th:text="${product.code}"></td>
        <td><a th:href="@{'/products?category=' +${product.category}}" th:text="${product.category}"></a></td>
        <td th:text="${product.price} + ' €'"></td>
        <td th:text="${product.name}"></td>
        <td th:text="${product.description}"></td>
    </tr>
    </tbody>
</table>

<script>
    $(document).ready(function(){
        // Filtros por código, precio y stock
        $("#priceFilter, #stockFilter").on("input", function() {
            var priceFilter = parseFloat($("#priceFilter").val()) || 0;
            var stockFilter = parseInt($("#stockFilter").val()) || 0;

            $("#productTable tr").filter(function() {
                var price = parseFloat($(this).find("td:nth-child(3)").text());
                var stock = parseInt($(this).find("td:nth-child(4)").text());

                $(this).toggle(
                    (price >= priceFilter) &&
                    (stock >= stockFilter)
                );
            });
        });

        // Redirigir al enlace /products/{id} al presionar Enter en el filtro por ID
        $("#idFilter").on("keypress", function(event) {
            if (event.which === 13) { // Enter key pressed
                var id = $(this).val();
                if (id) {
                    window.location.href = '/products/' + id;
                }
            }
        });

        $("#categoryFilter").on("change", function() {
            var category = $(this).val();
            if (category) {
                window.location.href = '/products?category=' + category;
            }
        });
        // Reestablecer filtros
        $("#resetFilter").on("click", function() {
            $("#idFilter").val('');
            $("#categoryFilter").val('');
            $("#priceFilter").val('');
            $("#stockFilter").val('');
            $("#productTable tr").show();
        });
    });
</script>

</body>
</html>